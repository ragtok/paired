import { Feather } from "@expo/vector-icons";
// import {
//   DefaultTheme,
//   NavigationContainer,
//   Theme,
// } from "@react-navigation/native";
//import {
//  createNativeStackNavigator,
//  NativeStackScreenProps,
//} from "@react-navigation/native-stack";
import { BlurView } from "expo-blur";
import { LinearGradient } from "expo-linear-gradient";
import { StatusBar } from "expo-status-bar";
//import * as React from "react";
import { useEffect, useRef, useState } from "react";
import {
  Animated,
  ColorValue,
  Dimensions,
  Image,
  ImageSourcePropType,
  Linking,
  PanResponder,
  Pressable,
  ScrollView,
  StyleProp,
  StyleSheet,
  Text,
  TextInput,
  View,
  ViewStyle,
} from "react-native";
import { SafeAreaView } from "react-native-safe-area-context";

// // ---------- Navigation Types ----------
// type RootStackParamList = {
//   Home: undefined;
//   Details: { provider: string } | undefined;
//   Settings: undefined;
//   Profile: undefined;
//   ContactSupport:
//     | {
//         user: {
//           name: string;
//           email: string;
//         };
//       }
//     | undefined;
// };

// type HomeProps = NativeStackScreenProps<RootStackParamList, "Home">;
// type DetailsProps = NativeStackScreenProps<RootStackParamList, "Details">;
// type SettingsProps = NativeStackScreenProps<RootStackParamList, "Settings">;
// type ProfileProps = NativeStackScreenProps<RootStackParamList, "Profile">;
// type ContactSupportProps = NativeStackScreenProps<
//   RootStackParamList,
//   "ContactSupport"
// >;

// ---------- Shared UI ----------
// const Stack = createNativeStackNavigator<RootStackParamList>();
// const { height: screenHeight } = Dimensions.get("window");

// const varLoggedInUserName = "Mike Oxsmall";
// const varLoggedInUserEmail = "mike.oxsmall@example.com";

// const Separator: React.FC = () => <View style={styles.separator} />;
// const varAppName = "CODE MOKEYS";
// const varAppVersion = "v1.0.0";

// const MyDarkTheme: Theme = {
//   ...DefaultTheme,
//   colors: {
//     ...DefaultTheme.colors,
//     background: "#121212",
//     card: "#121212",
//     text: "#FFFFFF",
//     border: "#121212",
//     primary: "#00BFA6",
//   },
// };

// ----- Gradient typing helpers -----
type ColorTuple = readonly [ColorValue, ColorValue, ...ColorValue[]];
const DEFAULT_GRADIENT = ["#00BFA6", "#242424"] as const;

// Component props
type GradientBorderProps = {
  children?: React.ReactNode;
  style?: StyleProp<ViewStyle>;
  colors?: ColorTuple;
  radius?: number;
};

function GradientBorder({
  children,
  style,
  colors,
  radius = 10,
}: GradientBorderProps) {
  return (
    <LinearGradient
      colors={colors ?? DEFAULT_GRADIENT}
      locations={[0, 0.25]}
      start={{ x: 0, y: 0 }}
      end={{ x: 0.2, y: 1 }}
      style={[styles.gradientBorder, { borderRadius: radius }, style]}
    >
      <View style={[styles.innerBox, { borderRadius: radius - 2 }]}>{children}</View>
    </LinearGradient>
  );
}

// ---------- Screen (Sign in) ----------
function SignInScreen({ navigation }: HomeProps) {
  const providers = ["Google", "Instagram", "Apple ID"] as const;
  const providerIcons: Record<(typeof providers)[number], ImageSourcePropType> = {
    Google: require("./assets/src/images/social_google.png"),
    Instagram: require("./assets/src/images/social_instagram.png"),
    "Apple ID": require("./assets/src/images/social_apple.png"),
  };

  return (
    <SafeAreaView style={styles.screen}>
      <StatusBar style="light" backgroundColor="#121212" animated />

      <View style={styles.content}>
        <Image
          source={require("./assets/src/images/logo.png")}
          style={{ width: 50, height: 50 }}
        />

        <Separator />
        <Text style={styles.heading}>{varAppName}</Text>

        <Separator />
        <Text style={styles.heading}>Sign in</Text>

        <Separator />

        {providers.map((p) => (
          <GradientBorder key={p} style={[styles.fullWidth, { marginBottom: 12 }]}>
            <Pressable
              style={styles.button}
              onPress={() => navigation.navigate("Details", { provider: p })}
            >
              <Image source={providerIcons[p]} style={styles.buttonIcon} />
              <Text style={styles.buttonText}>{p}</Text>
            </Pressable>
          </GradientBorder>
        ))}
      </View>

      <View style={styles.footer}>
        <Text style={styles.footerText}>
          By continuing, you agree to our{" "}
          <Text
            style={styles.link}
            onPress={() => Linking.openURL("https://yourwebsite.com/terms")}
          >
            Terms of Service
          </Text>{" "}
          and{" "}
          <Text
            style={styles.link}
            onPress={() => Linking.openURL("https://yourwebsite.com/privacy")}
          >
            Privacy Policy
          </Text>
          .
        </Text>
      </View>

      <View style={styles.footer}>
        <Text style={styles.footerText}>Code Monkeys</Text>
      </View>
    </SafeAreaView>
  );
}

// ---------- Screen (Main Screen) ----------
type TabType = "Questions" | "Things to Do";

function MainScreen({ route, navigation }: DetailsProps) {
  // const provider = route?.params?.provider; // (unused but fine)
  const [activeTab, setActiveTab] = useState<TabType>("Questions");
  const [index, setIndex] = useState<number>(0);
  const [favorites, setFavorites] = useState<Record<number, boolean>>({});
  const [borderTintState, setBorderTintState] =
    useState<"default" | "left" | "right">("default");

  const questionPrompts: string[] = [
    "If you could have dinner with any historical figure, who would it be and why?",
    "What‚Äôs a small habit that changed your life?",
    "What‚Äôs one thing you want to learn this year?",
    "What‚Äôs a book that changed your perspective?",
    "What‚Äôs a challenge you overcame recently, and how?",
  ];

  const todoPrompts: string[] = [
    "Take a 15-minute walk without your phone.",
    "Write down 3 things you‚Äôre grateful for.",
    "Declutter one drawer or folder.",
    "Drink a full glass of water now.",
    "Text a friend you haven‚Äôt spoken to in a while.",
    "Do 10 push-ups or 1 minute of stretching.",
  ];

  const currentPrompts = activeTab === "Questions" ? questionPrompts : todoPrompts;

  // reroll handlers
  const [isRerollPressed, setIsRerollPressed] = useState<boolean>(false);
  const onReroll = () => {
    setIndex((i) => (i - 1 + currentPrompts.length) % currentPrompts.length);
  };

  useEffect(() => setIndex(0), [activeTab]);

  const onPrev = () =>
    setIndex((i) => (i - 1 + currentPrompts.length) % currentPrompts.length);
  const onNext = () => setIndex((i) => (i + 1) % currentPrompts.length);
  const onToggleFavorite = () => setFavorites((f) => ({ ...f, [index]: !f[index] }));

  // ---------- Local Animation Logic ----------
  const position = useRef(new Animated.ValueXY()).current;

  const panResponder = useRef(
    PanResponder.create({
      onMoveShouldSetPanResponder: () => true,

      onPanResponderMove: (_, gesture) => {
        position.setValue({ x: gesture.dx, y: 0 });

        if (gesture.dx > 50) {
          if (borderTintState !== "right") setBorderTintState("right");
        } else if (gesture.dx < -50) {
          if (borderTintState !== "left") setBorderTintState("left");
        } else {
          if (borderTintState !== "default") setBorderTintState("default");
        }
      },

      onPanResponderRelease: (_, gesture) => {
        const shouldSwipe = Math.abs(gesture.dx) > 120;

        if (shouldSwipe) {
          const direction: "right" | "left" = gesture.dx > 0 ? "right" : "left";
          Animated.timing(position, {
            toValue: { x: direction === "right" ? 500 : -500, y: 0 },
            duration: 300,
            useNativeDriver: true,
          }).start(() => {
            direction === "right" ? onNext() : onPrev();
            position.setValue({ x: 0, y: 0 });
            setBorderTintState("default");
          });
        } else {
          setBorderTintState("default");
          Animated.spring(position, {
            toValue: { x: 0, y: 0 },
            useNativeDriver: true,
          }).start();
        }
      },

      onPanResponderTerminate: () => {
        setBorderTintState("default");
        Animated.spring(position, {
          toValue: { x: 0, y: 0 },
          useNativeDriver: true,
        }).start();
      },
    })
  ).current;

  const rotate =
    (position.x.interpolate({
      inputRange: [-300, 0, 300],
      outputRange: ["-10deg", "0deg", "10deg"],
    }) as unknown) as Animated.AnimatedInterpolation<string>;

  const animatedStyle = { transform: [{ translateX: position.x }, { rotate }] };

  // Gradient border colors (typed as readonly tuples)
  const borderColors: ColorTuple =
    borderTintState === "right"
      ? (["#00BFA6", "#121212"] as const)
      : borderTintState === "left"
      ? (["#FF4D6D", "#121212"] as const)
      : (["#00BFA620", "#242424"] as const);

  return (
    <SafeAreaView style={styles.screen}>
      <View style={[styles.content, { paddingHorizontal: 24 }]}>
        <Separator />
        <View style={styles.header}>
          <Image
            source={require("./assets/src/images/logo.png")}
            style={styles.headerLogo}
          />
          <Pressable
            onPress={() => navigation.navigate("Settings")}
            style={styles.headerMenuButton}
          >
            <Feather name="menu" size={35} color="#00BFA6" />
          </Pressable>
        </View>

        <View style={styles.tabContainer}>
          {(["Questions", "Things to Do"] as TabType[]).map((tab) => (
            <GradientBorder
              key={tab}
              style={[
                styles.tabButtonWrapper,
                activeTab === tab && styles.tabButtonActiveBorder,
              ]}
            >
              <Pressable
                style={[styles.tabButton, activeTab === tab && styles.tabButtonActive]}
                onPress={() => setActiveTab(tab)}
              >
                <Text
                  style={[
                    styles.tabButtonText,
                    activeTab === tab && styles.tabButtonTextActive,
                  ]}
                >
                  {tab}
                </Text>
              </Pressable>
            </GradientBorder>
          ))}
        </View>

        <Separator />

        {/* ---------- Animated Card ---------- */}
        <Animated.View {...panResponder.panHandlers} style={[cardStyles.cardShadow, animatedStyle]}>
          <LinearGradient
            colors={borderColors}
            start={{ x: 1, y: 1 }}
            end={{ x: 0, y: 0.1 }}
            style={{ padding: 2, borderRadius: 18 }}
          >
            <BlurView intensity={50} tint="dark" style={cardStyles.cardInner}>
              <View style={cardStyles.topRow}>
                <View style={cardStyles.modePill}>
                  <Text style={cardStyles.modePillText}>{activeTab}</Text>
                </View>
                <Pressable onPress={onToggleFavorite} hitSlop={10} style={cardStyles.favoriteBtn}>
                  <Feather
                    name="heart"
                    size={20}
                    color={favorites[index] ? "#00BFA6" : "#6B6B6B"}
                  />
                </Pressable>
              </View>

              <View style={cardStyles.centerWrap}>
                <Text style={cardStyles.promptText}>{currentPrompts[index]}</Text>
              </View>

              <View style={cardStyles.arrowsRow}>
                <Pressable onPress={onPrev} style={cardStyles.circleBtn}>
                  <Feather name="chevron-left" size={18} color="#FF4D6D" />
                </Pressable>
                <Pressable onPress={onNext} style={cardStyles.circleBtn}>
                  <Feather name="chevron-right" size={18} color="#00BFA6" />
                </Pressable>
              </View>

              <View style={cardStyles.hintPill}>
                <Text style={cardStyles.hintText}>Swipe right or left</Text>
              </View>
            </BlurView>
          </LinearGradient>
        </Animated.View>

        <Separator />

        {/* ---------- Reroll Icon Button ---------- */}
        <Pressable
          onPressIn={() => setIsRerollPressed(true)}
          onPressOut={() => setIsRerollPressed(false)}
          onPress={onReroll}
          hitSlop={10}
          style={[cardStyles.favoriteBtn, isRerollPressed && { backgroundColor: "rgba(0,191,166,0.2)" }]}
        >
          <Feather name="rotate-ccw" size={40} color={isRerollPressed ? "#00BFA6" : "#6B6B6B"} />
        </Pressable>

        <Separator />

        <GradientBorder style={{ width: "70%" }}>
          <Pressable style={styles.button} onPress={() => navigation.goBack()}>
            <Text style={styles.buttonText}>‚Üê Go back (test)</Text>
          </Pressable>
        </GradientBorder>

        <View style={styles.footer}>
          <Text style={styles.footerText}>Code Monkeys</Text>
        </View>
      </View>
    </SafeAreaView>
  );
}

// ---------- Screen (Profile) ----------
type FeatherIconName = keyof typeof Feather.glyphMap;

export function ProfileScreen({ navigation }: ProfileProps) {
  const [q1, setQ1] = useState<string | null>(null);
  const [q2, setQ2] = useState<string | null>(null);
  const [q3, setQ3] = useState<string | null>(null);
  const [q4, setQ4] = useState<string | null>(null);
  const [q5, setQ5] = useState<string[]>([]);
  const toggleQ5 = (val: string) =>
    setQ5((arr) => (arr.includes(val) ? arr.filter((v) => v !== val) : [...arr, val]));

  const canSave = Boolean(q1 && q2 && q3 && q4);

  return (
    <SafeAreaView style={styles.screen}>
      {/* Header */}
      <View style={ProfileScreenStyles.header}>
        <Pressable
          onPress={() => navigation.goBack()}
          hitSlop={10}
          style={({ pressed }) => [
            ProfileScreenStyles.headerIconButton,
            pressed && ProfileScreenStyles.headerIconButtonActive,
          ]}
        >
          <Feather name="arrow-left" size={22} color="#00BFA6" />
        </Pressable>

        <View style={{ flex: 1, marginLeft: 8 }}>
          <Text style={ProfileScreenStyles.headerTitle}>Profile</Text>
          <Text style={ProfileScreenStyles.headerSubtitle}>Personalize Your Activities</Text>
        </View>

        <View style={{ width: 40 }} />
      </View>

      <ScrollView contentContainerStyle={ProfileScreenStyles.container} showsVerticalScrollIndicator={false}>
        {/* Card 1 */}
        <PrefCard number="1" title="What kind of activities do you usually prefer?">
          <OptionGrid>
            <OptionPill icon="zap" label="Active" selected={q1 === "Active"} onPress={() => setQ1("Active")} />
            <OptionPill icon="tablet" label="Passive" selected={q1 === "Passive"} onPress={() => setQ1("Passive")} />
            <OptionPill
              icon="codesandbox"
              label="Creative"
              selected={q1 === "Creative"}
              onPress={() => setQ1("Creative")}
            />
          </OptionGrid>
        </PrefCard>

        {/* Card 2 */}
        <PrefCard number="2" title="Do you prefer indoor or outdoor activities?">
          <OptionGrid>
            <OptionPill icon="home" label="Indoor" selected={q2 === "Indoor"} onPress={() => setQ2("Indoor")} />
            <OptionPill icon="sun" label="Outdoor" selected={q2 === "Outdoor"} onPress={() => setQ2("Outdoor")} />
            <OptionPill icon="shuffle" label="Both" selected={q2 === "Both"} onPress={() => setQ2("Both")} />
          </OptionGrid>
        </PrefCard>

        {/* Card 3 */}
        <PrefCard number="3" title="How much time do you usually have?">
          <OptionGrid>
            <OptionPill
              icon="clock"
              label="Quick (under 1 hour)"
              selected={q3 === "Quick"}
              onPress={() => setQ3("Quick")}
            />
            <OptionPill icon="clock" label="Medium (1‚Äì3 hours)" selected={q3 === "Medium"} onPress={() => setQ3("Medium")} />
            <OptionPill icon="clock" label="Long (half-day or more)" selected={q3 === "Long"} onPress={() => setQ3("Long")} />
          </OptionGrid>
        </PrefCard>

        {/* Card 4 */}
        <PrefCard number="4" title="Do you enjoy solo or group activities more?">
          <OptionGrid>
            <OptionPill icon="user" label="Solo" selected={q4 === "Solo"} onPress={() => setQ4("Solo")} />
            <OptionPill icon="users" label="With friends" selected={q4 === "With friends"} onPress={() => setQ4("With friends")} />
            <OptionPill icon="compass" label="Either" selected={q4 === "Either"} onPress={() => setQ4("Either")} />
          </OptionGrid>
        </PrefCard>

        {/* Card 5 */}
        <PrefCard number="5" title="What‚Äôs your vibe?">
          <Text style={ProfileScreenStyles.hint}>Select all that apply</Text>
          <OptionGrid>
            <OptionPill icon="coffee" label="Chill" selected={q5.includes("Chill")} onPress={() => toggleQ5("Chill")} multi />
            <OptionPill icon="activity" label="Adventurous" selected={q5.includes("Adventurous")} onPress={() => toggleQ5("Adventurous")} multi />
            <OptionPill icon="message-circle" label="Social" selected={q5.includes("Social")} onPress={() => toggleQ5("Social")} multi />
            <OptionPill icon="zap" label="Creative" selected={q5.includes("Creative")} onPress={() => toggleQ5("Creative")} multi />
          </OptionGrid>
        </PrefCard>

        {/* Save */}
        <Pressable
          disabled={!canSave}
          onPress={() => {
            console.log({ q1, q2, q3, q4, q5 });
            navigation.goBack();
          }}
          style={({ pressed }) => [
            ProfileScreenStyles.saveBtn,
            (!canSave || pressed) && ProfileScreenStyles.saveBtnDisabled,
          ]}
        >
          <Feather name="save" size={16} color={canSave ? "#00BFA6" : "#6B6B6B"} />
          <Text style={[ProfileScreenStyles.saveBtnText, !canSave && { color: "#6B6B6B" }]}>
            Save Preferences
          </Text>
        </Pressable>
      </ScrollView>
    </SafeAreaView>
  );
}

/* ---------- Tiny UI helpers ---------- */
type PrefCardProps = { number: string; title: string; children?: React.ReactNode };
function PrefCard({ number, title, children }: PrefCardProps) {
  return (
    <View style={ProfileScreenStyles.card}>
      <View style={ProfileScreenStyles.cardHeader}>
        <View style={ProfileScreenStyles.numBadge}>
          <Text style={ProfileScreenStyles.numBadgeText}>{number}</Text>
        </View>
        <Text style={ProfileScreenStyles.cardTitle}>{title}</Text>
      </View>
      {children}
    </View>
  );
}

function OptionGrid({ children }: { children?: React.ReactNode }) {
  return <View style={ProfileScreenStyles.grid}>{children}</View>;
}

type OptionPillProps = {
  icon: FeatherIconName;
  label: string;
  selected?: boolean;
  onPress?: () => void;
  multi?: boolean;
};

function OptionPill({ icon, label, selected, onPress }: OptionPillProps) {
  return (
    <Pressable
      onPress={onPress}
      style={({ pressed }) => [
        ProfileScreenStyles.pill,
        selected && ProfileScreenStyles.pillSelected,
        pressed && ProfileScreenStyles.pillPressed,
      ]}
    >
      <Feather name={icon} size={16} color={selected ? "#00BFA6" : "#B5B5B5"} style={{ marginRight: 8 }} />
      <Text style={[ProfileScreenStyles.pillText, selected && { color: "#00BFA6" }]}>{label}</Text>
    </Pressable>
  );
}

// ---------- Screen (Contact Support) ----------
export function ContactSupportScreen({ navigation, route }: ContactSupportProps) {
  const userFromRoute = route?.params?.user || { name: "Unknown User", email: "unknown@nomail.app" };
  const [name] = useState<string>(userFromRoute.name);
  const [email] = useState<string>(userFromRoute.email);

  const [subject, setSubject] = useState<string>("");
  const [message, setMessage] = useState<string>("");
  const [isSending, setIsSending] = useState<boolean>(false);
  const [touched, setTouched] = useState<Record<string, boolean>>({});

  const MAX_MESSAGE = 600;

  const subjectValid = subject.trim().length >= 3 || subject.trim() === "";
  const messageValid = message.trim().length >= 10 || message.trim() === "";
  const canSubmit = subject.trim().length >= 3 && message.trim().length >= 10;

  const [showSuccess, setShowSuccess] = useState<boolean>(false);
  const fadeAnim = useRef(new Animated.Value(0)).current;

  useEffect(() => {
    Animated.timing(fadeAnim, {
      toValue: showSuccess ? 1 : 0,
      duration: 220,
      useNativeDriver: true,
    }).start();
  }, [showSuccess, fadeAnim]);

  const onSubmit = async () => {
    if (!canSubmit || isSending) return;
    try {
      setIsSending(true);
      await new Promise((res) => setTimeout(res, 900)); // simulate send
      setShowSuccess(true);
    } catch {
      alert("Something went wrong. Please try again.");
    } finally {
      setIsSending(false);
    }
  };

  return (
    <SafeAreaView style={styles.screen}>
      {/* Header */}
      <View style={contactStyles.header}>
        <Pressable
          onPress={() => navigation.goBack()}
          hitSlop={10}
          style={({ pressed }) => [
            contactStyles.headerIconButton,
            pressed && contactStyles.headerIconButtonActive,
          ]}
        >
          <Feather name="arrow-left" size={22} color="#00BFA6" />
        </Pressable>
        <Text style={contactStyles.headerTitle}>Contact Support</Text>
        <View style={{ width: 40 }} />
      </View>

      <ScrollView
        style={{ backgroundColor: "#121212" }}
        contentContainerStyle={contactStyles.container}
        keyboardShouldPersistTaps="handled"
        showsVerticalScrollIndicator={false}
      >
        {showSuccess && (
          <View style={contactStyles.modalOverlay}>
            <View style={contactStyles.modalCard}>
              <Text style={contactStyles.modalTitle}>Message Sent!</Text>
              <Text style={contactStyles.modalSubtitle}>
                Thanks for reaching out ‚Äî our team will get back to you soon.
              </Text>

              <Separator />

              <GradientBorder style={{ width: "70%" }}>
                <Pressable
                  style={styles.button}
                  onPress={() => {
                    setShowSuccess(false);
                    navigation.goBack();
                  }}
                >
                  <Text style={styles.buttonText}>OK</Text>
                </Pressable>
              </GradientBorder>
            </View>
          </View>
        )}

        {/* Card */}
        <View style={contactStyles.card}>
          <Text style={contactStyles.cardIntro}>
            Tell us what‚Äôs up ‚Äî we‚Äôll get back to you as soon as possible.
          </Text>

          {/* Subject */}
          <Text style={contactStyles.label}>Subject</Text>
          <TextInput
            value={subject}
            onChangeText={setSubject}
            onBlur={() => setTouched((t) => ({ ...t, subject: true }))}
            placeholder="What can we help with?"
            placeholderTextColor="#6B6B6B"
            style={[
              contactStyles.input,
              touched.subject && subject.trim().length < 3 && contactStyles.inputError,
            ]}
          />
          {touched.subject && subject.trim().length < 3 ? (
            <Text style={contactStyles.errorText}>Please enter at least 3 characters.</Text>
          ) : null}

          {/* Message */}
          <Text style={contactStyles.label}>Message</Text>
          <TextInput
            value={message}
            onChangeText={(txt) => (txt.length <= MAX_MESSAGE ? setMessage(txt) : null)}
            onBlur={() => setTouched((t) => ({ ...t, message: true }))}
            placeholder="Describe the issue or share your feedback‚Ä¶"
            placeholderTextColor="#6B6B6B"
            multiline
            textAlignVertical="top"
            style={[
              contactStyles.input,
              contactStyles.textarea,
              touched.message && message.trim().length < 10 && contactStyles.inputError,
            ]}
          />
          <View style={contactStyles.counterRow}>
            <Text style={contactStyles.hintText}>Min 10 characters ‚Ä¢ Be as specific as you can</Text>
            <Text style={contactStyles.counterText}>{message.length}/{MAX_MESSAGE}</Text>
          </View>

          {/* Submit */}
          <View style={{ marginTop: 14 }}>
            <GradientBorder style={contactStyles.submitWrap}>
              <Pressable onPress={onSubmit} disabled={!canSubmit || isSending} style={styles.button}>
                <Feather
                  name="send"
                  size={18}
                  color={canSubmit ? "#00BFA6" : "#6B6B6B"}
                  style={styles.buttonIcon}
                />
                <Text style={[styles.buttonText, !canSubmit && { color: "#6B6B6B" }]}>
                  {isSending ? "Sending‚Ä¶" : "Send message"}
                </Text>
              </Pressable>
            </GradientBorder>
          </View>
        </View>

        {/* Help links */}
        <View style={contactStyles.group}>
          <Text style={contactStyles.groupTitle}>Helpful links</Text>

          <Pressable
            style={settingsStyles.listRow}
            onPress={() => Linking.openURL("https://yourwebsite.com/privacy")}
          >
            <Text style={settingsStyles.listRowText}>Privacy Policy</Text>
            <Feather name="external-link" size={16} color="#6B6B6B" />
          </Pressable>

          <Pressable
            style={settingsStyles.listRow}
            onPress={() => Linking.openURL("https://yourwebsite.com/terms")}
          >
            <Text style={settingsStyles.listRowText}>Terms of Service</Text>
            <Feather name="external-link" size={16} color="#6B6B6B" />
          </Pressable>
        </View>

        <View style={{ height: 16 }} />
      </ScrollView>
    </SafeAreaView>
  );
}

// ---------- Screen (Settings) ----------
export function SettingsScreen({ navigation }: SettingsProps) {
  const [notifications, setNotifications] = useState<boolean>(true);
  const [darkMode, setDarkMode] = useState<boolean>(true);

  return (
    <SafeAreaView style={styles.screen}>
      {/* Header */}
      <View style={settingsStyles.header}>
        <Pressable
          onPress={() => navigation.goBack()}
          hitSlop={10}
          style={({ pressed }) => [
            settingsStyles.headerIconButton,
            pressed && settingsStyles.headerIconButtonActive,
          ]}
        >
          <Feather name="arrow-left" size={22} color="#00BFA6" />
        </Pressable>
        <Text style={settingsStyles.headerTitle}>Settings</Text>
        <View style={{ width: 40 }} />
      </View>

      {/* Content */}
      <View style={settingsStyles.container}>
        {/* Preferences */}
        <View style={settingsStyles.group}>
          {/* Profile */}
          <Pressable
            style={settingsStyles.cardRow}
            android_ripple={{ color: "#1a1a1a" }}
            onPress={() => navigation.navigate("Profile")}
          >
            <View style={settingsStyles.rowLeft}>
              <View style={settingsStyles.rowIconWrap}>
                <Feather name="user-check" size={18} color="#00BFA6" />
              </View>
              <View>
                <Text style={settingsStyles.rowTitle}>Profile</Text>
                <Text style={settingsStyles.rowSubtitle}>Personalize your experience</Text>
              </View>
            </View>
            <Feather name="chevron-right" size={18} color="#6B6B6B" />
          </Pressable>

          {/* Notifications */}
          <Pressable
            style={settingsStyles.cardRow}
            android_ripple={{ color: "#1a1a1a" }}
            onPress={() => setNotifications(!notifications)}
          >
            <View style={settingsStyles.rowLeft}>
              <View style={settingsStyles.rowIconWrap}>
                <Feather name="bell" size={18} color="#00BFA6" />
              </View>
              <View>
                <Text style={settingsStyles.rowTitle}>Notifications</Text>
                <Text style={settingsStyles.rowSubtitle}>
                  Get daily question or activity suggestions
                </Text>
              </View>
            </View>
            <Feather
              name={notifications ? "toggle-right" : "toggle-left"}
              size={36}
              color={notifications ? "#00BFA6" : "#6B6B6B"}
            />
          </Pressable>
        </View>

        {/* Support */}
        <View style={settingsStyles.group}>
          <Text style={settingsStyles.groupTitle}>Support</Text>
          <Pressable
            style={settingsStyles.listRow}
            onPress={() => Linking.openURL("https://yourwebsite.com/privacy")}
          >
            <Text style={settingsStyles.listRowText}>Privacy Policy</Text>
            <Feather name="external-link" size={16} color="#6B6B6B" />
          </Pressable>
          <Pressable
            style={settingsStyles.listRow}
            onPress={() => Linking.openURL("https://yourwebsite.com/terms")}
          >
            <Text style={settingsStyles.listRowText}>Terms of Service</Text>
            <Feather name="external-link" size={16} color="#6B6B6B" />
          </Pressable>
          {/* SettingsScreen ‚Üí inside the Support group */}
          <Pressable
            style={settingsStyles.listRow}
            onPress={() =>
              navigation.navigate("ContactSupport", {
                user: { name: varLoggedInUserName, email: varLoggedInUserEmail },
              })
            }
          >
            <Text style={settingsStyles.listRowText}>Contact Support</Text>
            <Feather name="mail" size={16} color="#6B6B6B" />
          </Pressable>
        </View>

        {/* About */}
        <View style={settingsStyles.group}>
          <Text style={settingsStyles.groupTitle}>About</Text>
          <View style={settingsStyles.cardBox}>
            <Text style={settingsStyles.appName}>
              {varAppName} {varAppVersion}
            </Text>
            <Text style={settingsStyles.appDesc}>
              Discover engaging questions and activities to spark conversations and
              exploration - with more features coming soon.
            </Text>
          </View>
        </View>
      </View>
    </SafeAreaView>
  );
}

// ---------- App entry ----------
export default function App() {
  return (
    <NavigationContainer theme={MyDarkTheme}>
      <Stack.Navigator
        screenOptions={{
          headerShown: false,
          animation: "none",
          contentStyle: { backgroundColor: "#121212" },
          headerStyle: { backgroundColor: "#121212" },
          freezeOnBlur: true,
        }}
      >
        <Stack.Screen name="Home" component={SignInScreen} />
        <Stack.Screen name="Details" component={MainScreen} />
        <Stack.Screen name="Settings" component={SettingsScreen} />
        <Stack.Screen name="Profile" component={ProfileScreen} />
        <Stack.Screen name="ContactSupport" component={ContactSupportScreen} />
      </Stack.Navigator>
    </NavigationContainer>
  );
}

// ---------- Styles ----------
const styles = StyleSheet.create({
  screen: { flex: 1, backgroundColor: "#121212" },
  content: {
    flex: 1,
    justifyContent: "center",
    alignItems: "center",
    paddingHorizontal: 16,
  },
  appName: { color: "#FFFFFF", fontSize: 14, opacity: 0.9 },
  heading: { color: "#FFFFFF", fontSize: 18, fontWeight: "600" },
  gradientBorder: { padding: 2, borderRadius: 10 },
  innerBox: { backgroundColor: "#121212", borderRadius: 8 },
  button: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "center",
    paddingVertical: 15,
    paddingHorizontal: 15,
    gap: 10,
  },
  buttonIcon: {
    width: 22,
    height: 22,
    resizeMode: "contain",
    marginRight: 8,
  },
  buttonText: {
    color: "#FFFFFF",
    fontSize: 16,
    fontWeight: "600",
  },
  fullWidth: { width: "70%", alignSelf: "center" },
//   separator: {
//     marginVertical: 10,
//     borderBottomColor: "#737373",
//     alignSelf: "stretch",
//     opacity: 0.4,
//   },
  header: {
    width: "100%",
    paddingHorizontal: 20,
    paddingTop: 10,
    paddingBottom: 10,
    flexDirection: "row",
    justifyContent: "space-between",
    alignItems: "center",
    backgroundColor: "#121212",
    position: "absolute",
    top: 0,
    left: 0,
    right: 0,
    zIndex: 10,
  },
  headerMenuButton: { marginRight: -40 },
  headerLogo: { width: 40, height: 40, resizeMode: "contain" },
  footer: {
    paddingVertical: 8,
    paddingHorizontal: 16,
    alignItems: "center",
  },
  footerText: { color: "#999", textAlign: "center", fontSize: 12 },
  link: { color: "#00BFA6" },
  tabContainer: {
    flexDirection: "row",
    justifyContent: "center",
    alignSelf: "center",
    width: "90%",
    columnGap: 20,
    marginTop: 50,
    marginBottom: 8,
  },
  tabButtonWrapper: { flex: 1, borderRadius: 10 },
  tabButton: {
    alignItems: "center",
    justifyContent: "center",
    paddingVertical: 16,
    borderRadius: 10,
  },
  tabButtonActive: { backgroundColor: "#1A1A1A" },
  tabButtonText: { color: "#FFFFFF", fontSize: 15, fontWeight: "600" },
  tabButtonTextActive: { color: "#00BFA6" },
  tabButtonActiveBorder: {
    borderWidth: 1,
    borderColor: "#00BFA6",
    borderRadius: 10,
  },
  rerollButton: {
    padding: 7,
    borderRadius: 999,
    backgroundColor: "rgba(255,255,255,0.03)",
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#2A2A2A",
    alignItems: "center",
    justifyContent: "center",
  },
  rerollButtonActive: {
    backgroundColor: "rgba(0,191,166,0.2)",
    borderColor: "#00BFA6",
  },
});

const cardStyles = StyleSheet.create({
  cardShadow: {
    width: "90%",
    alignSelf: "center",
    borderRadius: 18,
    shadowColor: "#000",
    shadowOpacity: 0.35,
    shadowRadius: 18,
    shadowOffset: { width: 0, height: 12 },
    elevation: 8,
    minHeight: screenHeight * 0.55,
    overflow: "hidden",
  },
  cardInner: {
    borderRadius: 18,
    backgroundColor: "rgba(18, 18, 18, 0.8)",
    paddingTop: 16,
    paddingBottom: 24,
    paddingHorizontal: 16,
    minHeight: screenHeight * 0.55,
    overflow: "hidden",
  },
  topRow: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
  },
  modePill: {
    backgroundColor: "#1C1C1C",
    borderRadius: 999,
    paddingVertical: 6,
    paddingHorizontal: 12,
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#2A2A2A",
  },
  modePillText: { color: "#D8D8D8", fontSize: 12, fontWeight: "600" },
  favoriteBtn: {
    padding: 6,
    borderRadius: 999,
    backgroundColor: "rgba(255,255,255,0.03)",
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#2A2A2A",
  },
  centerWrap: {
    flexGrow: 1,
    width: "100%",
    alignItems: "center",
    justifyContent: "center",
    padding: 50,
  },
  promptText: {
    color: "#FFFFFF",
    fontSize: 18,
    lineHeight: 26,
    textAlign: "center",
    fontWeight: "600",
  },
  arrowsRow: {
    position: "absolute",
    left: 0,
    right: 0,
    top: "50%",
    marginTop: -12,
    paddingHorizontal: 16,
    flexDirection: "row",
    justifyContent: "space-between",
  },
  circleBtn: {
    width: 32,
    height: 32,
    borderRadius: 16,
    backgroundColor: "rgba(255,255,255,0.06)",
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#2A2A2A",
    alignItems: "center",
    justifyContent: "center",
  },
  hintPill: {
    alignSelf: "center",
    marginTop: 8,
    backgroundColor: "rgba(255,255,255,0.06)",
    borderRadius: 999,
    paddingVertical: 8,
    paddingHorizontal: 14,
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#2A2A2A",
  },
  hintText: { color: "#B5B5B5", fontSize: 12 },
});

// settings screen style
const settingsStyles = StyleSheet.create({
  screen: { flex: 1, backgroundColor: "#121212" },

  header: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    paddingHorizontal: 16,
    paddingTop: 6,
    paddingBottom: 12,
    borderBottomWidth: StyleSheet.hairlineWidth,
    borderBottomColor: "#1A1A1A",
  },
  headerTitle: { color: "#FFFFFF", fontSize: 22, fontWeight: "800" },

  headerIconButton: {
    width: 40,
    height: 40,
    borderRadius: 20,
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: "rgba(255,255,255,0.03)",
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#2A2A2A",
  },
  headerIconButtonActive: {
    backgroundColor: "rgba(0,191,166,0.2)",
    borderColor: "#00BFA6",
  },

  container: { padding: 16 },

  group: {
    backgroundColor: "#141414",
    borderRadius: 14,
    padding: 12,
    marginBottom: 18,
    borderWidth: 1,
    borderColor: "#1E1E1E",
  },
  groupTitle: {
    color: "#BEBEBE",
    fontSize: 13,
    marginBottom: 10,
    marginLeft: 4,
  },

  cardRow: {
    backgroundColor: "#1A1A1A",
    borderRadius: 12,
    paddingVertical: 14,
    paddingHorizontal: 12,
    borderWidth: 1,
    borderColor: "#2A2A2A",
    flexDirection: "row",
    justifyContent: "space-between",
    alignItems: "center",
    marginBottom: 10,
  },
  rowLeft: { flexDirection: "row", alignItems: "center", gap: 12 },
  rowIconWrap: {
    width: 34,
    height: 34,
    borderRadius: 17,
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: "rgba(255,255,255,0.04)",
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#2A2A2A",
  },
  rowTitle: { color: "#FFFFFF", fontSize: 16, fontWeight: "700" },
  rowSubtitle: { color: "#999", fontSize: 12, marginTop: 2 },

  chevWrap: {
    width: 30,
    height: 30,
    borderRadius: 15,
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: "rgba(255,255,255,0.03)",
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#2A2A2A",
  },

  cardBox: {
    backgroundColor: "#1A1A1A",
    borderRadius: 12,
    padding: 14,
    borderWidth: 1,
    borderColor: "#2A2A2A",
  },
  appName: {
    color: "#FFFFFF",
    fontSize: 14,
    fontWeight: "700",
    marginBottom: 6,
  },
  appDesc: { color: "#B5B5B5", fontSize: 13, lineHeight: 18 },

  listRow: {
    backgroundColor: "#1A1A1A",
    borderRadius: 12,
    paddingVertical: 14,
    paddingHorizontal: 14,
    borderWidth: 1,
    borderColor: "#2A2A2A",
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    marginBottom: 10,
  },
  listRowText: { color: "#FFFFFF", fontSize: 15, fontWeight: "600" },
});

// --------- Profile Screen Style -----------
const ProfileScreenStyles = StyleSheet.create({
  screen: { flex: 1, backgroundColor: "#121212" },

  header: {
    flexDirection: "row",
    alignItems: "center",
    paddingHorizontal: 16,
    paddingTop: 6,
    paddingBottom: 12,
    borderBottomWidth: StyleSheet.hairlineWidth,
    borderBottomColor: "#1A1A1A",
  },
  headerTitle: { color: "#FFFFFF", fontSize: 20, fontWeight: "800" },
  headerSubtitle: { color: "#9A9A9A", fontSize: 12, marginTop: 2 },

  headerIconButton: {
    width: 40,
    height: 40,
    borderRadius: 20,
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: "rgba(255,255,255,0.03)",
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#2A2A2A",
  },
  headerIconButtonActive: {
    backgroundColor: "rgba(0,191,166,0.2)",
    borderColor: "#00BFA6",
  },

  container: { padding: 12, paddingBottom: 24 },

  card: {
    backgroundColor: "#1A1A1A",
    borderRadius: 18,
    borderWidth: 1,
    borderColor: "#2A2A2A",
    padding: 14,
    marginBottom: 16,
  },
  cardHeader: {
    flexDirection: "row",
    alignItems: "center",
    marginBottom: 12,
  },
  numBadge: {
    width: 26,
    height: 26,
    borderRadius: 13,
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: "rgba(0,191,166,0.15)",
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#00BFA6",
    marginRight: 10,
  },
  numBadgeText: { color: "#00BFA6", fontWeight: "700", fontSize: 12 },
  cardTitle: {
    color: "#FFFFFF",
    fontSize: 16,
    fontWeight: "800",
    flex: 1,
    lineHeight: 22,
  },

  grid: {
    flexDirection: "row",
    flexWrap: "wrap",
    alignItems: "flex-start",
    gap: 10,
  },

  pill: {
    alignSelf: "flex-start",
    maxWidth: "100%",
    minHeight: 44,
    borderRadius: 12,
    backgroundColor: "#232323",
    borderWidth: 1,
    borderColor: "#2A2A2A",
    paddingHorizontal: 12,
    alignItems: "center",
    justifyContent: "center",
    flexDirection: "row",
  },
  pillSelected: {
    borderColor: "#00BFA6",
    backgroundColor: "#1C1F1F",
  },
  pillPressed: {
    backgroundColor: "#262626",
  },
  pillText: {
    color: "#E6E6E6",
    fontSize: 14,
    fontWeight: "600",
    textAlign: "center",
    flexShrink: 1,
  },

  checkDot: {
    width: 8,
    height: 8,
    borderRadius: 4,
    marginLeft: 8,
    backgroundColor: "transparent",
    borderWidth: 1,
    borderColor: "#444",
  },
  checkDotOn: {
    backgroundColor: "#00BFA6",
    borderColor: "#00BFA6",
  },

  hint: { color: "#9A9A9A", fontSize: 12, marginBottom: 8, marginLeft: 4 },

  saveBtn: {
    marginTop: 8,
    height: 48,
    borderRadius: 999,
    borderWidth: 1,
    borderColor: "#2A2A2A",
    backgroundColor: "#171717",
    alignItems: "center",
    justifyContent: "center",
    flexDirection: "row",
    gap: 8,
  },
  saveBtnDisabled: { opacity: 0.6 },
  saveBtnText: { color: "#FFFFFF", fontWeight: "700" },
});

// ------------- Screen (Contact Support) style
const contactStyles = StyleSheet.create({
  header: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    paddingHorizontal: 16,
    paddingTop: 6,
    paddingBottom: 12,
    borderBottomWidth: StyleSheet.hairlineWidth,
    borderBottomColor: "#1A1A1A",
  },
  headerTitle: { color: "#FFFFFF", fontSize: 22, fontWeight: "800" },
  headerIconButton: {
    width: 50,
    height: 50,
    borderRadius: 20,
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: "rgba(255,255,255,0.03)",
    borderWidth: StyleSheet.hairlineWidth,
    borderColor: "#2A2A2A",
  },
  headerIconButtonActive: {
    backgroundColor: "rgba(0,191,166,0.2)",
    borderColor: "#00BFA6",
  },

  container: { padding: 16, paddingBottom: 24 },

  card: {
    backgroundColor: "#1A1A1A",
    borderRadius: 14,
    borderWidth: 1,
    borderColor: "#2A2A2A",
    padding: 14,
    marginBottom: 18,
  },
  cardIntro: {
    color: "#DADADA",
    fontSize: 14,
    lineHeight: 20,
    marginBottom: 10,
  },
  caption: { color: "#9A9A9A", fontSize: 12, marginBottom: 14 },

  label: {
    color: "#FFFFFF",
    fontSize: 13,
    fontWeight: "700",
    marginBottom: 6,
    marginTop: 10,
  },
  input: {
    backgroundColor: "#232323",
    color: "#FFFFFF",
    borderRadius: 12,
    borderWidth: 1,
    borderColor: "#2A2A2A",
    paddingHorizontal: 12,
    paddingVertical: 12,
  },
  inputError: { borderColor: "#FF4D6D" },
  textarea: { minHeight: 140, paddingTop: 12 },

  counterRow: {
    marginTop: 6,
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
  },
  hintText: { color: "#9A9A9A", fontSize: 12 },
  counterText: { color: "#B5B5B5", fontSize: 12 },

  submitBtn: {
    height: 48,
    borderRadius: 999,
    backgroundColor: "#171717",
    borderWidth: 1,
    borderColor: "#2A2A2A",
    alignItems: "center",
    justifyContent: "center",
    flexDirection: "row",
    gap: 8,
  },
  submitBtnPressed: { backgroundColor: "#1E1E1E" },
  submitBtnDisabled: { opacity: 0.6 },
  submitText: { color: "#FFFFFF", fontWeight: "700" },

  group: {
    backgroundColor: "#141414",
    borderRadius: 14,
    padding: 12,
    marginBottom: 18,
    borderWidth: 1,
    borderColor: "#1E1E1E",
  },
  groupTitle: { color: "#BEBEBE", fontSize: 13, marginBottom: 10, marginLeft: 4 },
  submitWrap: { width: "70%", alignSelf: "center" },
  submitGradient: { padding: 2, borderRadius: 10 },

  successPopup: {
    position: "absolute",
    bottom: 40,
    alignSelf: "center",
    flexDirection: "row",
    alignItems: "center",
    backgroundColor: "#1A1A1A",
    borderRadius: 12,
    borderWidth: 1,
    borderColor: "#00BFA6",
    paddingVertical: 12,
    paddingHorizontal: 18,
    shadowColor: "#000",
    shadowOpacity: 0.3,
    shadowRadius: 10,
    shadowOffset: { width: 0, height: 6 },
    elevation: 8,
  },
  successText: { color: "#FFFFFF", fontSize: 15, fontWeight: "600" },

  overlay: {
    position: "absolute",
    top: 0,
    left: 0,
    right: 0,
    bottom: 0,
    backgroundColor: "rgba(0,0,0,0.45)",
    alignItems: "center",
    justifyContent: "center",
    padding: 24,
    zIndex: 999,
  },
  overlayCard: {
    width: "100%",
    maxWidth: 420,
    backgroundColor: "#1A1A1A",
    borderRadius: 16,
    borderWidth: 1,
    borderColor: "#2A2A2A",
    padding: 16,
    alignItems: "center",
  },
  overlayTitle: { color: "#FFFFFF", fontSize: 18, fontWeight: "800", marginBottom: 4, textAlign: "center" },
  overlayMsg: { color: "#B5B5B5", fontSize: 14, lineHeight: 20, textAlign: "center" },

  modalOverlay: {
    position: "absolute",
    top: 0,
    left: 0,
    right: 0,
    bottom: 0,
    backgroundColor: "rgba(0,0,0,0.7)",
    alignItems: "center",
    justifyContent: "center",
    zIndex: 99,
  },

  modalCard: {
    backgroundColor: "#1A1A1A",
    borderRadius: 18,
    borderWidth: 1,
    borderColor: "#2A2A2A",
    width: "80%",
    paddingVertical: 28,
    paddingHorizontal: 20,
    alignItems: "center",
    justifyContent: "center",
    shadowColor: "#000",
    shadowOpacity: 0.4,
    shadowRadius: 20,
    elevation: 10,
  },

  modalTitle: { color: "#FFFFFF", fontSize: 18, fontWeight: "800", marginBottom: 8, textAlign: "center" },
  modalSubtitle: { color: "#B5B5B5", fontSize: 14, lineHeight: 20, textAlign: "center", marginHorizontal: 8 },

  // üîß Added to fix missing style error
  errorText: { color: "#FF4D6D", fontSize: 12, marginTop: 4 },
});
